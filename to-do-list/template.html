<div class="bg-image">
   <style ng-if="$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage">
      .bg-image {
         background: url('__/plugins/to-do-list/{{values.backgroundImage}}') no-repeat center center fixed;
         -webkit-background-size: cover;
         -moz-background-size: cover;
         -o-background-size: cover;
         background-size: cover;
      }
   </style>
   <style>
      .todo-opacity {
         background: rgba(250, 250, 250, 0.3);
         border: none;
      }

      .btnHidden {
         display: none;
      }

      .wrapper:hover img {
         /* Change the filter in here */
      }

      .wrapper:hover .btnHidden {
         display: inline-block;
      }

      .dropdown-thin a {
         height: 300px;
         padding-top: 2px;
      }
   </style>
   <div class="row p-2" ng-if="!values.showJson">
      <div class="col-md-12 text-center">
         <h5>
            <div class="pull-left btn-group" ng-if="$root.uiPrefs.arcBauSettings.length>0">
               <span class="btn-group ml-2">
                  <span uib-dropdown dropdown-append-to-body class="input-group-append"
                     ng-if="$root.uiPrefs.arcBauSettings.length>1" title="{{'ALLLISTS' | translate}}">
                     <button class="btn" uib-dropdown-toggle
                        ng-class="{'btn-secondary':!$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage}">
                        <span class="fa fa-list-ol"></span>
                     </button>
                     <ul class="dropdown-menu" style="max-height: 400px;" uib-dropdown-menu role="menu"
                        aria-labelledby="split-button">
                        <li role="menuitem" ng-repeat="settings in $root.uiPrefs.arcBauSettings">
                           <div ng-click="updateSettings($index)" class="ml-2 click">
                              <span ng-if="$root.uiPrefs.arcBauSettings[$index].stepPercentage>0"
                                 class="mt-1 mr-2 text-white badge badge-pill pull-right"
                                 ng-class="{'active':$root.uiPrefs.arcBauSettings[$index].stepPercentage==0,
                              'badge-success':$root.uiPrefs.arcBauSettings[$index].stepPercentage==100,
                              'badge-info':$root.uiPrefs.arcBauSettings[$index].stepPercentage>1 && $root.uiPrefs.arcBauSettings[$index].stepPercentage<100}">
                                 {{$root.uiPrefs.arcBauSettings[$index].stepPercentage}} %
                              </span>
                              <i class="fa fa-fw {{settings.icon}}" title="Delete Settings"></i>
                              <span class="mr-2">{{settings.name}}</span>
                           </div>
                        </li>
                     </ul>
                  </span>
                  <button class="btn" title="{{'CHANGEICON' | translate}}"
                     ng-class="{'btn-secondary':!$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage}"
                     ng-click="updateIcon()">
                     <i
                        class="fa fa-fw {{$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].icon}}"></i>
                  </button>
                  <input spellcheck="false" spellcheck="false" type="text"
                     class="input-group-append input-group-prepend"
                     ng-class="{'todo-opacity':$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage}"
                     placeholder="Enter list Name..." title="{{'EDITLISTNAME' | translate}}"
                     ng-model="$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].name" />
                  <div uib-dropdown dropdown-append-to-body class="input-group-prepend">
                     <button class="btn" uib-dropdown-toggle title="{{'OPTIONS' | translate}}"
                        ng-class="{'btn-secondary':!$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage}">
                        <i class="fa fa-ellipsis-v"></i>
                     </button>
                     <ul uib-dropdown-menu role="menu" role="menu" aria-labelledby="single-button"
                        style="max-height: 250px;">
                        <li role="menuitem" class="click" ng-click="changeView()">
                           <span class="ml-2 mr-2">
                              <i class="fa fa-expand" aria-hidden="true"> </i>
                           </span>
                           <span class="mr-2" translate="EXPANDVIEW">
                           </span>
                        </li>
                        <li role="menuitem" class="click"
                           ng-click="$root.uiPrefs.arcBauValues.numbers=!$root.uiPrefs.arcBauValues.numbers">
                           <span style="font-size: 0.8em" class="ml-2 mr-2"><strong>123</strong></span>
                           <span class="mr-2" translate="TOGGLENUMBERS">
                           </span>
                           <a href class="pull-right mr-2">
                              <i class="fa fa-toggle-on" ng-if="$root.uiPrefs.arcBauValues.numbers"></i>
                              <i class="fa fa-toggle-off" ng-if="!$root.uiPrefs.arcBauValues.numbers"></i>
                           </a>
                        </li>
                        <li role="menuitem" class="click"
                           ng-click="$root.uiPrefs.arcBauValues.showInstances=!$root.uiPrefs.arcBauValues.showInstances">
                           <span class="ml-2 mr-2">
                              <i class="fa Instance"></i>
                           </span>
                           <span class="mr-2" translate="TOGGLEINSTANCENAME">
                           </span>
                           <a href class="pull-right mr-2">
                              <i class="fa fa-toggle-on" ng-if="$root.uiPrefs.arcBauValues.showInstances"></i>
                              <i class="fa fa-toggle-off" ng-if="!$root.uiPrefs.arcBauValues.showInstances"></i>
                           </a>
                        </li>
                        <li role="menuitem" class="click" ng-click="toggleBackground()">
                           <span class="ml-2 mr-2">
                              <i class="fa fa-picture-o"></i> </span>
                           <span class="mr-2" translate="TOGGLEBACKGROUND">
                           </span>
                           <a href class="pull-right mr-2">
                              <i class="fa fa-toggle-on"
                                 ng-if="$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage"></i>
                              <i class="fa fa-toggle-off"
                                 ng-if="!$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage"></i>
                           </a>
                        </li>
                     </ul>
                  </div>

                  <button class="btn" ng-click="showListInJson()" ng-class="{'btn-secondary':!$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage,
                  'active':values.showJson}" title="{{'EDIT' | translate}}">
                     <i class="fa fa-fw fa-pencil-square-o"></i>
                     <i class="fa fa-check fa-mark" ng-if="values.showJson"></i>
                  </button>
                  <button class="btn" ng-click="buildAgenda();values.showCalendar=!values.showCalendar" ng-class="{'btn-secondary':!$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage,
                  'active':values.showCalendar}" title="{{'SHOWCALENDAR' | translate}}">
                     <i class="fa fa-fw fa-calendar"></i>
                     <i class="fa fa-check fa-mark" ng-if="values.showCalendar"></i>
                  </button>
                  <button class="btn" ng-click="resetPercentage()"
                     ng-class="{'btn-secondary':!$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage}"
                     title="{{'RESETSTATUS' | translate}}">
                     <i class="fa fa-fw fa-retweet"></i>
                  </button>
                  <button class="btn" ng-click="getInstancesInfo()"
                     ng-class="{'btn-secondary':!$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage}"
                     title="{{'REFRESHTM1OBJECTSLIST' | translate}}">
                     <i class="fa fa-fw fa-refresh"></i>
                  </button>
                  <button class="btn" ng-click="openModalSaveAsList()"
                     ng-class="{'btn-secondary':!$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage}"
                     title="{{'SAVEAS' | translate}}">
                     <i class="fa fa-fw fa-clone"></i>
                  </button>
                  <button class="btn" ng-click="openModalAddList()"
                     ng-class="{'btn-secondary':!$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage}"
                     title="{{'ADDALIST' | translate}}">
                     <i class="fa fa-fw fa-plus"></i>
                  </button>
                  <button class="btn" ng-click="openModalRemoveList()"
                     ng-class="{'btn-secondary':!$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage}"
                     title="{{'DELETELIST' | translate}}">
                     <i class="fa fa-fw fa-trash"></i>
                  </button>
               </span>
            </div>
            <span ng-if="$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].stepPercentage>0"
               class="mt-2 ml-2 text-white badge badge-pill pull-left"
               ng-class="{'active':$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].stepPercentage==0,
      'badge-success':$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].stepPercentage==100,
      'badge-info':$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].stepPercentage>1 && $root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].stepPercentage<100}">
               {{$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].stepPercentage}} %
            </span>
         </h5>
      </div>
   </div>
   <div ng-if="$root.uiPrefs.arcBauSettings.length==0" class="row">
      <div class="col-md-4">

      </div>
      <div class="col-md-4">
         <div class="card"
            ng-class="{'todo-opacity':$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage}">
            <div class="card-body p-2">
               <a href="" ng-click="openModalAddList()">
                  <i class="fa fa-fw fa-plus mr-1"></i>
                  <span translate="ADDALIST"></span>
               </a>
            </div>
         </div>
         <div>
            <div class="alert alert-default mt-2" role="alert"
               ng-class="{'todo-opacity':$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage}">
               <i class="fa fa-fw fa-question-circle mr-1"></i>
               <span translate="CREATENEWTODOLISTTOHELPYOUORGANIZINGYOURTASKS"></span>
            </div>
         </div>
      </div>
   </div>
   <div class="row pr-2 pl-2 pb-2" ng-if="$root.uiPrefs.arcBauSettings.length>0 && !values.showJson">
      <div class="col-md-12">
         <div class="progress" style="height:5px;opacity:0.5">
            <div class="progress-bar bg-success" role="progressbar"
               ng-class="{'bg-info progress-bar-striped':$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].stepPercentage<100}"
               ng-style="{'width': $root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].stepPercentage + '%'}">
            </div>
         </div>
      </div>
   </div>
   <div class="row pr-2 pl-2">
      <div class="col-md-12">
         <div class="alert alert-info mt-2" role="alert"
            ng-if="$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].content.length==0 && !$root.uiPrefs.arcBauValues.editing">
            <span translate="CLICKTHEEDITICONTOSTART"></span>
         </div>
      </div>
   </div>
   <div ng-if="values.showCalendar">
         <div>
            <h3>
               <span class="btn-group"> 
                  <button class="btn btn-sm btn-secondary"  ng-click="prevMonth(lists.calendar.day)"
                  title="{{'NEXTMONTH' | translate}}">
                  <i class="fa fa-fw fa-arrow-left"></i>
               </button>                                               
                  <button class="btn btn-sm btn-secondary"  ng-click="nextMonth(lists.calendar.day)"
                  title="{{'NEXTMONTH' | translate}}">
                  <i class="fa fa-fw fa-arrow-right"></i>
               </button>
               </span>
               <span class="ml-2">{{lists.calendar.monthYear}}</span>
            </h3>

         </div>
            <div ng-if="options.activeDay.actions.length>0">
               <h4>{{options.activeDay.name}}</h4>
               <div class="row">

                  <div class="col-md-4" ng-repeat="action in options.activeDay.actions track by $index">
                     <div class="card mb-2 mt-2 wrapper">
                        <div class="card-header"
                        ng-if="!action.edit"
                           style="padding: 5px 10px; cursor: default;">
                           
                           <div ng-if="!action.edit">
                              <span style="padding-left:0px;" ng-if="$root.uiPrefs.arcBauValues.numbers">
                                 <span class="badge badge-pill click" ng-click="updateCategory(action)"
                                    ng-class="action.category">
                                    {{$parent.$parent.$parent.$index+1}}.{{$index+1}}</span>
                              </span>
                              <i ng-if="action.info.length>0" class="fa fa-info-circle mr-1"
                                 title="{{action.info}}"></i>
                              <span ng-if="!action.edit" class="click" ng-click="action.edit=!action.edit">
                                 {{action.name}}
                              </span>
   
                              <button class="btn btn-sm btnHidden m-0 p-0" ng-click="action.edit=!action.edit"
                                 title="{{'EDIT' | translate}}">
                                 <i class="fa fa-fw fa-pencil"></i>
                              </button>
   
                              <a ng-if="!action.edit" class="pull-right pt-1"
                                 ng-click="action.open=!action.open;calculatePercentage()"
                                 title="{{'UPDATESTATUS' | translate}}">
                                 <i class="fa fa-fw"
                                    ng-class="{'fa-check-square-o':!action.open,'fa-square-o':action.open }"></i>
                              </a>
                           </div>
                        </div>
                        <div class="card-body" style="padding:10px">
                           <div>
                              <i ng-if="action.type=='Cube View'" class="fa cubes" style="margin-right:5px"></i>
                              <i ng-if="action.type=='Dimension Editor'" class="fa dimensions"
                                 style="margin-right:5px"></i>
                              <i ng-if="action.type=='Subset Editor'" class="fa subset"
                                 style="margin-right:5px"></i>
                              <i ng-if="action.type=='Process'" class="fa processes" style="margin-right:5px"></i>
                              <i ng-if="action.type=='Rules'" class="fa rule" style="margin-right:5px"></i>
                              <i ng-if="action.type=='Chore'" class="fa chores" style="margin-right:5px"></i>
                              <i ng-if="action.type=='Link'" class="fa fa-globe" style="margin-right:5px"></i>
   
                              <a href="#/process/{{action.instance}}/{{action.process}}?tab=parameters"
                                 ng-if="action.type=='Process'" ng-class="[row.branch.item_class]" title="{{action.instance}}:{{action.process}}">
                                 <span
                                    ng-if="$root.uiPrefs.arcBauValues.showInstances">{{action.instance}}:</span>{{action.process}}
                              </a>
   
                              <a href="#/chore/{{action.instance}}/{{action.chore}}"
                                 ng-class="[row.branch.item_class]" 
                                 title="{{action.instance}}:{{action.chore}}"
                                 ng-if="action.type=='Chore'">
                                 <span
                                    ng-if="$root.uiPrefs.arcBauValues.showInstances">{{action.instance}}:</span>{{action.chore}}
                              </a>
   
                              <span ng-if="action.type=='Subset Editor'">
                                 <a ng-if="!values.enableNewHierarchyCreation[action.instance]"
                                    href="#/dimension/{{action.instance}}/{{action.dimension}}/{{action.dimension}}/subset/{{action.subset}}"
                                    ng-class="[row.branch.item_class]" 
                                    title="{{action.instance}}:{{action.dimension}}:{{action.dimension}}:{{action.subset}}">
                                    <span
                                       ng-if="$root.uiPrefs.arcBauValues.showInstances">{{action.instance}}:</span>{{action.dimension}}:{{action.subset}}
                                 </a>
                                 <a ng-if="values.enableNewHierarchyCreation[action.instance]"
                                    href="#/dimension/{{action.instance}}/{{action.dimension}}/{{action.hierarchy}}/subset/{{action.subset}}"
                                    ng-class="[row.branch.item_class]" 
                                    title="{{action.instance}}:{{action.dimension}}:{{action.hierarchy}}:{{action.subset}}">
                                    <span
                                       ng-if="$root.uiPrefs.arcBauValues.showInstances">{{action.instance}}:</span>{{action.dimension}}:{{action.hierarchy}}:{{action.subset}}
                                 </a>
                              </span>
                              <span ng-if="action.type=='Dimension Editor'">
                                 <a ng-if="!values.enableNewHierarchyCreation[action.instance]"
                                    href="#/dimension/{{action.instance}}/{{action.dimension}}/{{action.dimension}}"
                                    ng-class="[row.branch.item_class]"
                                    title="{{action.instance}}:{{action.dimension}}">
                                    <span
                                       ng-if="$root.uiPrefs.arcBauValues.showInstances">{{action.instance}}:</span>{{action.dimension}}
                                 </a>
                                 <a ng-if="values.enableNewHierarchyCreation[action.instance]"
                                    href="#/dimension/{{action.instance}}/{{action.dimension}}/{{action.hierarchy}}"
                                    ng-class="[row.branch.item_class]"
                                    title="{{action.instance}}:{{action.dimension}}:{{action.hierarchy}}:{{action.subset}}">
                                    <span
                                       ng-if="$root.uiPrefs.arcBauValues.showInstances">{{action.instance}}:</span>{{action.dimension}}:{{action.hierarchy}}
                                 </a>
                              </span>
                              <a ng-if="action.type=='Cube View'"
                                 href="#/cube/{{action.instance}}/{{action.cube}}/view/{{action.view}}"
                                 ng-class="[row.branch.item_class]"
                                 title="{{action.instance}}:{{action.cube}}:{{action.view}}">
                                 <span
                                    ng-if="$root.uiPrefs.arcBauValues.showInstances">{{action.instance}}:</span>{{action.cube}}:{{action.view}}
                              </a>
                              <a ng-if="action.type=='Rules'" href="#/cube/{{action.instance}}/{{action.cube}}"
                                 ng-class="[row.branch.item_class]"
                                 title="{{action.instance}}:{{action.cube}}">
                                 <span
                                    ng-if="$root.uiPrefs.arcBauValues.showInstances">{{action.instance}}:</span>{{action.cube}}
                              </a>
   
                              <a ng-if="action.type=='Link'" href="{{action.link}}" target="_blank"
                                 title="Go to {{action.link}}">
                                 {{action.text}}
                              </a>
                              <!-- RUN PROCESS -->
                              <span class="pull-right" ng-if="action.type=='Process' && action.execute">
                                 <button class="btn btn-secondary btn-sm text-warning"
                                    title="Execute {{action.instance}}:{{action.process}}"
                                    ng-click="executeProcess(action)">
                                    <i class="fa fa-fw fa-bolt"></i>
                                 </button>
                              </span>
                              <!-- RUN CHORE -->
                              <span class="pull-right" ng-if="action.type=='Chore' && action.execute">
                                 <button class="btn btn-secondary btn-sm text-warning"
                                    title="Execute {{action.instance}}:{{action.chore}}"
                                    ng-click="executeChore(action)">
                                    <i class="fa fa-fw fa-bolt"></i>
                                 </button>
                              </span>
                              <div class="mt-1" ng-if="action.setDueDate">
                                 <span class="badge {{action.dueDateBadge}}" title="{{action.dueDate | amDateFormat:'dddd DD MMM YYYY'}}">
                                    <i class="fa fa-fw fa-clock-o" ng-class="{'fa-repeat':action.pattern.key!='DOESNOTREPEAT'}"></i>
                                 {{action.dueDate | amDateFormat:'MMM DD'}}</span>
                              </div>
                           </div>
                        </div>
                     </div> 
                  </div> 
               </div>
            </div>
            <table class="table table-hover table-sm">
               <thead>
                  <tr>
                     <th class="text-center" ng-repeat="day in lists.weekdays" style="min-width:150px;border-top:none"> {{day}} </th>
                  </tr>
               </thead>
               <tbody>              
                   <tr ng-repeat="week in lists.calendar" style="height:100px" ng-if="$index>1">
                      <td class="text-center click" ng-repeat="day in week.days" style="border: 1px solid #dee2e6" ng-click="setActiveDay(day)">
                        <div class="text-right">
                           <span class="badge" ng-class="{'text-secondary':day.differentMonth,'badge-info':day.currentDay}">{{day.key}}</span>
                        </div>
                        <div ng-repeat="action in day.actions track by $index" class="text-left">                           
                           <span class="badge">
                              <i ng-if="action.type=='Cube View'" class="fa cubes" style="margin-right:5px"></i>
                              <i ng-if="action.type=='Dimension Editor'" class="fa dimensions"
                                 style="margin-right:5px"></i>
                              <i ng-if="action.type=='Subset Editor'" class="fa subset"
                                 style="margin-right:5px"></i>
                              <i ng-if="action.type=='Process'" class="fa processes" style="margin-right:5px"></i>
                              <i ng-if="action.type=='Rules'" class="fa rule" style="margin-right:5px"></i>
                              <i ng-if="action.type=='Chore'" class="fa chores" style="margin-right:5px"></i>
                              <i ng-if="action.type=='Link'" class="fa fa-globe" style="margin-right:5px"></i>                              
                           <span class="d-inline-block text-truncate" style="max-width: 150px;">{{action.name}}</span>
                           </span>
                        </div>
                      </td>
                   </tr>
               </tbody>
            </table>
   </div>
   <div class="row pr-2 pl-2" ng-if="values.showJson">
      <div class="col-md-12">
         <auto-height>
            <div class="btn-group mb-2">
               <button type="button" class="btn text-info" ng-click="copyToClipboard()"
                  ng-class="{'btn-secondary':!$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage}"
                  title="{{'COPYTOCLIPBOARD' | translate}}">
                  <i class="fa fa-fw fa-clipboard"></i>
               </button>
               <button type="button" class="btn text-danger" ng-click="clearJson()"
                  ng-class="{'btn-secondary':!$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage}"
                  title="{{'CLEAR' | translate}}">
                  <i class="fa fa-fw fa-trash"></i>
               </button>
               <button type="button" class="btn text-success" ng-click="validateJson()"
                  ng-class="{'btn-secondary':!$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage}"
                  title="{{'VALIDATE' | translate}}">
                  <i class="fa fa-fw fa-check-circle"></i>
               </button>
               <button type="button" class="btn" ng-click="cancelJson()"
                  ng-class="{'btn-secondary':!$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage}"
                  title="{{'CANCEL' | translate}}">
                  <i class="fa fa-fw fa-close"></i>
               </button>
            </div>
            <button class="ml-2 btn btn-info" ng-if="copied">
               <span translate="COPIED"></span>
            </button>
            <div class="card">
               <div class="card-header p-2">
                  <span class="p-1">
                     <i class="fa fa-fw fa-pencil-square-o mr-1"></i>
                     <span translate="SETTINGS"></span>
                  </span>
               </div>
               <div class="card-body p-0">
                  <textarea rows="33" id="myInput" spellcheck="false" spellcheck="false" type="text"
                     class="form-control" ng-model="options.stringList" />
                  </div>
         </div>
         </auto-height>
         </div>
   </div>
   <div class="pr-2 pl-2 mt-2" ng-if="values.displayMissingBackground">
      <div class="alert alert-warning" role="alert">
         <div>{{values.missingBgMessage1}}</div>
         <div>{{values.missingBgMessage2}}</div>
      </div>
   </div>
   <div class="row pr-2 pl-2" ng-if="!values.showJson && !values.showCalendar">
      <div class="col-md-12">
         <auto-height>
            <div class="row">
               <div class="col-md-4 mt-2"
               ng-class="{'col-md-6':$root.uiPrefs.arcBauValues.view=='fa-table',
               'col-md-12':$root.uiPrefs.arcBauValues.view=='fa-list-alt' }"
                  ng-repeat="step in $root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].content track by $index">
                  <div class="card bg-secondary" 
                  ng-class="{
                  'bg-success':step.nbActionsOpen>0 && step.nbActionsOpen==step.nbActionsTotal,
                    'bg-info':step.nbActionsOpen>0 && step.nbActionsOpen!=step.nbActionsTotal}">
                     <div class="card-header text-white wrapper" style="padding: 5px 10px; cursor: default;">
                        <div class="card-text">
                           <div ng-if="step.edit" class="mb-2">
                              <button class="btn btn-sm btn-secondary" ng-click="step.edit=!step.edit"
                              title="{{'CLOSEEDITMODE' | translate}}">
                              <i class="fa fa-fw fa-close"></i>
                           </button>
                                                        
                           <span class="btn-group pull-right">    
                              <div uib-dropdown dropdown-append-to-body class="input-group-prepend">
                                 <button class="btn btn-sm btn-secondary" uib-dropdown-toggle title="{{'OPTIONS' | translate}}">
                                    <i class="fa fa-ellipsis-v"></i>
                                 </button>
                                 <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="split-button">
                                    <li role="menuitem" class="click mr-2" ng-click="moveStep($index,$index-1)">
                                       <i class="ml-2 fa fa-arrow-circle-left"></i>
                                       <span ng-disabled="$index==0"
                                          translate="MOVELEFT">
                                       </span>
                                    </li>
                                    <li role="menuitem" class="click mr-2" ng-click="moveStep($index,$index+2)">
                                       <i class="ml-2 fa fa-arrow-circle-right"></i>
                                       <span ng-disabled="$index+1 == $root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].content.length"
                                           translate="MOVERIGHT">
                                       </span>
                                    </li>
                                 </ul>
                              </div>                                                                    
                              <button class="btn btn-sm btn-secondary"  ng-click="cloneStep($index, step)"
                                 title="{{'CLONESTEP' | translate}}">
                                 <i class="fa fa-fw fa-clone"></i>
                              </button>                                 
                              <button class="btn btn-sm btn-secondary"  ng-click="removeStep($index)"
                                 title="{{'REMOVESTEP' | translate}}">
                                 <i class="fa fa-fw fa-trash"></i>
                              </button>
                           </span> 
                           </div>
                           <div ng-if="!step.edit">
                              <span class="badge badge-pill badge-secondary" ng-if="$root.uiPrefs.arcBauValues.numbers">
                                 {{$index+1}}
                              </span>
                              <i ng-if="step.info.length>0" class="fa fa-info-circle mr-1"
                                 title="{{step.info}}"></i>
                              <label ng-if="!step.edit" class="click" ng-click="step.edit=!step.edit"> {{step.title}}
                              </label>
                              <button class="btn btn-sm pb-1 pt-0 mt-0 btnHidden" ng-click="step.edit=!step.edit"
                                 title="{{'EDIT' | translate}}">
                                 <i class="fa fa-fw fa-pencil text-white"></i>
                              </button>                               
                              <a class="pull-right pt-1 mr-2"
                              ng-click="updatePercentageOneStep(step)"
                              title="{{'UPDATESTATUS' | translate}}">
                              <i class="fa fa-fw"
                                 ng-class="{'fa-check-square-o':!step.open,'fa-square-o':step.open }"></i>
                           </a> 
                              <span ng-if="step.nbActionsOpen>0" class="mt-2 badge badge-pill text-white pull-right"
                                 >
                                 {{step.nbActionsOpen}}/{{step.nbActionsTotal}}
                              </span> 
                           </div>
                           <div class="input-group" ng-if="step.edit">
                              <div class="input-group-text input-group-append input-group-prepend click"
                                 ng-click="updateCategory(action)" ng-if="$root.uiPrefs.arcBauValues.numbers">
                                 {{$index+1}}
                              </div>
                              <div class="input-group-text input-group-append input-group-prepend">
                                 <i class="fa fa-header"></i>
                              </div>
                              <input spellcheck="false" spellcheck="false" type="text" class="form-control"
                                 placeholder="Enter Title..." ng-model="step.title" />                              
                              <div class="input-group mt-2">
                                 <div class="input-group-text input-group-append input-group-prepend">
                                    <i class="fa fa-info-circle"></i>
                                 </div>
                                 <input spellcheck="false" type="text" class="form-control"
                                    placeholder="Enter Description..." ng-model="step.info" />
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="card-body" style="padding:5px">
                        <div ng-repeat="action in step.actions track by $index">
                           <div class="card mb-2 mt-2 wrapper">
                              <div class="card-header"
                              ng-if="!action.edit"
                                 style="padding: 5px 10px; cursor: default;">
                                 
                                 <div ng-if="!action.edit">
                                    <span style="padding-left:0px;" ng-if="$root.uiPrefs.arcBauValues.numbers">
                                       <span class="badge badge-pill click" ng-click="updateCategory(action)"
                                          ng-class="action.category">
                                          {{$parent.$parent.$parent.$index+1}}.{{$index+1}}</span>
                                    </span>
                                    <i ng-if="action.info.length>0" class="fa fa-info-circle mr-1"
                                       title="{{action.info}}"></i>
                                    <span ng-if="!action.edit" class="click" ng-click="action.edit=!action.edit">
                                       {{action.name}}
                                    </span>

                                    <button class="btn btn-sm btnHidden m-0 p-0" ng-click="action.edit=!action.edit"
                                       title="{{'EDIT' | translate}}">
                                       <i class="fa fa-fw fa-pencil"></i>
                                    </button>

                                    <a ng-if="!action.edit" class="pull-right pt-1"
                                       ng-click="action.open=!action.open;calculatePercentage()"
                                       title="{{'UPDATESTATUS' | translate}}">
                                       <i class="fa fa-fw"
                                          ng-class="{'fa-check-square-o':!action.open,'fa-square-o':action.open }"></i>
                                    </a>
                                 </div>
                              </div>
                              <div class="card-body" style="padding:10px">
                                 <div ng-if="action.edit" class="mb-2">
                                    <button class="btn btn-sm btn-secondary" ng-click="action.edit=!action.edit"
                                    title="{{'CLOSEEDITMODE' | translate}}">
                                    <i class="fa fa-fw fa-close"></i>   
                                 </button>                                 
                                 <span class="btn-group pull-right">   
                                    <div uib-dropdown dropdown-append-to-body class="input-group-prepend">
                                       <button class="btn btn-sm btn-secondary" uib-dropdown-toggle title="{{'OPTIONS' | translate}}">
                                          <i class="fa fa-ellipsis-v"></i>
                                       </button>
                                       <ul class="dropdown-menu" uib-dropdown-menu role="menu"
                                          aria-labelledby="split-button">
                                          <li role="menuitem" class="click mr-2">
                                             <i class="ml-2 fa fa-arrow-circle-o-up"></i>
                                             <span ng-disabled="$index==0"
                                                ng-click="moveAction($parent.$parent.$parent.$index,$index,$index-1)"
                                                translate="MOVEUP">
                                             </span>
                                          </li>
                                          <li role="menuitem" class="click mr-2">
                                             <i class="ml-2 fa fa-arrow-circle-o-down"></i>
                                             <span ng-disabled="$index==0"
                                                ng-click="moveAction($parent.$parent.$parent.$index,$index,$index+2)"
                                                translate="MOVEDOWN">
                                             </span>
                                          </li>
                                          <li role="menuitem" class="click mr-2">
                                             <i class="ml-2 fa fa-arrow-circle-o-right"></i>
                                             <span ng-disabled="$index==0"
                                                ng-click="moveActionToStep($parent.$parent.$parent.$index,$parent.$parent.$parent.$index+1,$index)"
                                                translate="MOVETONEXTSTEP">
                                             </span>
                                          </li>
                                          <li role="menuitem" class="click mr-2">
                                             <i class="ml-2 fa fa-arrow-circle-o-left"></i>
                                             <span ng-disabled="$index==0"
                                                ng-click="moveActionToStep($parent.$parent.$parent.$index,$parent.$parent.$parent.$index-1,$index)"
                                                translate="MOVETOPREVIOUSSTEP">
                                             </span>
                                          </li>
                                       </ul>
                                    </div>                                                                  
                                    <button class="btn btn-sm btn-secondary"  ng-click="cloneAction($parent.$parent.$index, $index, action)"
                                       title="{{'CLONEACTION' | translate}}">
                                       <i class="fa fa-fw fa-clone"></i>
                                    </button>                                 
                                    <button class="btn btn-sm btn-secondary"  ng-click="removeAction($parent.$parent.$index, $index)"
                                       title="{{'REMOVEACTION' | translate}}">
                                       <i class="fa fa-fw fa-trash"></i>
                                    </button>
                                 </span>  

                                 </div>
                                 <div class="input-group mb-2" ng-if="action.edit">
                                    <div class="input-group-text input-group-append input-group-prepend click"
                                       ng-click="updateCategory(action)" ng-class="action.category"
                                       ng-if="$root.uiPrefs.arcBauValues.numbers">
                                       {{$parent.$parent.$parent.$index+1}}.{{$index+1}}
                                    </div>
                                    <div class="input-group-text input-group-append input-group-prepend">
                                       <i class="fa fa-header"></i>
                                    </div>
                                    <input spellcheck="false" spellcheck="false" type="text"
                                       class="form-control input-group-append input-group-prepend"
                                       placeholder="Enter Title..." ng-model="action.name" />
                                 </div>
                                 <div ng-if="!action.edit">
                                    <i ng-if="action.type=='Cube View'" class="fa cubes" style="margin-right:5px"></i>
                                    <i ng-if="action.type=='Dimension Editor'" class="fa dimensions"
                                       style="margin-right:5px"></i>
                                    <i ng-if="action.type=='Subset Editor'" class="fa subset"
                                       style="margin-right:5px"></i>
                                    <i ng-if="action.type=='Process'" class="fa processes" style="margin-right:5px"></i>
                                    <i ng-if="action.type=='Rules'" class="fa rule" style="margin-right:5px"></i>
                                    <i ng-if="action.type=='Chore'" class="fa chores" style="margin-right:5px"></i>
                                    <i ng-if="action.type=='Link'" class="fa fa-globe" style="margin-right:5px"></i>

                                    <a href="#/process/{{action.instance}}/{{action.process}}?tab=parameters"
                                       ng-if="action.type=='Process'" ng-class="[row.branch.item_class]" title="{{action.instance}}:{{action.process}}">
                                       <span
                                          ng-if="$root.uiPrefs.arcBauValues.showInstances">{{action.instance}}:</span>{{action.process}}
                                    </a>

                                    <a href="#/chore/{{action.instance}}/{{action.chore}}"
                                       ng-class="[row.branch.item_class]" 
                                       title="{{action.instance}}:{{action.chore}}"
                                       ng-if="action.type=='Chore'">
                                       <span
                                          ng-if="$root.uiPrefs.arcBauValues.showInstances">{{action.instance}}:</span>{{action.chore}}
                                    </a>

                                    <span ng-if="action.type=='Subset Editor'">
                                       <a ng-if="!values.enableNewHierarchyCreation[action.instance]"
                                          href="#/dimension/{{action.instance}}/{{action.dimension}}/{{action.dimension}}/subset/{{action.subset}}"
                                          ng-class="[row.branch.item_class]" 
                                          title="{{action.instance}}:{{action.dimension}}:{{action.dimension}}:{{action.subset}}">
                                          <span
                                             ng-if="$root.uiPrefs.arcBauValues.showInstances">{{action.instance}}:</span>{{action.dimension}}:{{action.subset}}
                                       </a>
                                       <a ng-if="values.enableNewHierarchyCreation[action.instance]"
                                          href="#/dimension/{{action.instance}}/{{action.dimension}}/{{action.hierarchy}}/subset/{{action.subset}}"
                                          ng-class="[row.branch.item_class]" 
                                          title="{{action.instance}}:{{action.dimension}}:{{action.hierarchy}}:{{action.subset}}">
                                          <span
                                             ng-if="$root.uiPrefs.arcBauValues.showInstances">{{action.instance}}:</span>{{action.dimension}}:{{action.hierarchy}}:{{action.subset}}
                                       </a>
                                    </span>
                                    <span ng-if="action.type=='Dimension Editor'">
                                       <a ng-if="!values.enableNewHierarchyCreation[action.instance]"
                                          href="#/dimension/{{action.instance}}/{{action.dimension}}/{{action.dimension}}"
                                          ng-class="[row.branch.item_class]"
                                          title="{{action.instance}}:{{action.dimension}}">
                                          <span
                                             ng-if="$root.uiPrefs.arcBauValues.showInstances">{{action.instance}}:</span>{{action.dimension}}
                                       </a>
                                       <a ng-if="values.enableNewHierarchyCreation[action.instance]"
                                          href="#/dimension/{{action.instance}}/{{action.dimension}}/{{action.hierarchy}}"
                                          ng-class="[row.branch.item_class]"
                                          title="{{action.instance}}:{{action.dimension}}:{{action.hierarchy}}:{{action.subset}}">
                                          <span
                                             ng-if="$root.uiPrefs.arcBauValues.showInstances">{{action.instance}}:</span>{{action.dimension}}:{{action.hierarchy}}
                                       </a>
                                    </span>
                                    <a ng-if="action.type=='Cube View'"
                                       href="#/cube/{{action.instance}}/{{action.cube}}/view/{{action.view}}"
                                       ng-class="[row.branch.item_class]"
                                       title="{{action.instance}}:{{action.cube}}:{{action.view}}">
                                       <span
                                          ng-if="$root.uiPrefs.arcBauValues.showInstances">{{action.instance}}:</span>{{action.cube}}:{{action.view}}
                                    </a>
                                    <a ng-if="action.type=='Rules'" href="#/cube/{{action.instance}}/{{action.cube}}"
                                       ng-class="[row.branch.item_class]"
                                       title="{{action.instance}}:{{action.cube}}">
                                       <span
                                          ng-if="$root.uiPrefs.arcBauValues.showInstances">{{action.instance}}:</span>{{action.cube}}
                                    </a>

                                    <a ng-if="action.type=='Link'" href="{{action.link}}" target="_blank"
                                       title="Go to {{action.link}}">
                                       {{action.text}}
                                    </a>
                                    <!-- RUN PROCESS -->
                                    <span class="pull-right" ng-if="action.type=='Process' && action.execute">
                                       <button class="btn btn-secondary btn-sm text-warning"
                                          title="Execute {{action.instance}}:{{action.process}}"
                                          ng-click="executeProcess(action)">
                                          <i class="fa fa-fw fa-bolt"></i>
                                       </button>
                                    </span>
                                    <!-- RUN CHORE -->
                                    <span class="pull-right" ng-if="action.type=='Chore' && action.execute">
                                       <button class="btn btn-secondary btn-sm text-warning"
                                          title="Execute {{action.instance}}:{{action.chore}}"
                                          ng-click="executeChore(action)">
                                          <i class="fa fa-fw fa-bolt"></i>
                                       </button>
                                    </span>
                                    <div class="mt-1" ng-if="action.setDueDate">
                                       <span class="badge {{action.dueDateBadge}}" title="{{action.dueDate | amDateFormat:'dddd DD MMM YYYY'}}">
                                          <i class="fa fa-fw fa-clock-o" ng-class="{'fa-repeat':action.pattern.key!='DOESNOTREPEAT'}"></i>
                                       {{action.dueDate | amDateFormat:'MMM DD'}}</span>
                                    </div>
                                 </div>
                                 <div ng-if="action.edit">
                                    <div class="input-group">
                                       <div class="input-group-text input-group-append input-group-prepend">
                                          <i class="fa fa-list"></i>
                                       </div>
                                       <div uib-dropdown dropdown-append-to-body>
                                          <button class="btn btn-secondary" uib-dropdown-toggle>
                                             {{action.type}}
                                             <span class="caret"></span>
                                          </button>
                                          <ul class="dropdown-menu" style="max-height: 400px;" uib-dropdown-menu role="menu"
                                             aria-labelledby="split-button">
                                             <li role="menuitem" ng-repeat="type in options.actionType">
                                                <div ng-click="action.type = type.key" class="ml-2 mr-2 click">
                                                   <i class="fa {{type.icon}}" style="margin-right:5px"></i>
                                                   <span>{{type.key}}</span>
                                                </div>
                                             </li>
                                          </ul>
                                       </div>
                                       <span class="btn btn-secondary pull-right" 
                                       ng-click="action.execute=!action.execute"
                                       ng-if="action.type=='Process' || action.type == 'Chore'">
                                          <span translate="EXECUTE"></span>
                                          <a href class="ml-1 mr-1 pt-2">
                                             <i class="fa fa-toggle-on" ng-if="action.execute"
                                                ></i>
                                             <i class="fa fa-toggle-off" ng-if="!action.execute"
                                                ></i>
                                          </a>
                                       </span>
                                    </div>
                                    <div class="input-group mt-2" ng-if="action.type!='Link'">
                                       <div class="input-group-text input-group-append input-group-prepend">
                                          <i class="fa Instance"></i>
                                       </div>
                                       <div uib-dropdown dropdown-append-to-body>
                                          <button class="btn btn-secondary" uib-dropdown-toggle>
                                             {{action.instance}}
                                             <span class="caret"></span>
                                          </button>
                                          <ul class="dropdown-menu" uib-dropdown-menu role="menu"
                                             aria-labelledby="split-button">
                                             <li role="menuitem" ng-repeat="instance in options.instances">
                                                <div ng-click="action.instance = instance" class="ml-2 mr-2 click">
                                                   <span>{{instance}}</span>
                                                </div>
                                             </li>
                                          </ul>
                                       </div>
                                    </div>
                                    <div class="input-group mt-2"
                                       ng-if="action.type=='Cube View' || action.type=='Rules'">
                                       <div class="input-group-text input-group-append input-group-prepend">
                                          <i class="fa "
                                             ng-class="{'cubes':action.type=='Cube View', 'rule':action.type=='Rules' }"></i>
                                       </div>
                                       <input spellcheck="false" type="text"
                                          class="input-group-append input-group-prepend form-control"
                                          placeholder="Enter cube name..." ng-model="action.cube"
                                          uib-typeahead="cube.Name for cube in lists.cubes[action.instance] | filter:$viewValue | limitTo:20"
                                          typeahead-append-to-body="true" spellcheck="false" autofocus />
                                    </div>

                                    <div class="input-group mt-2" ng-if="action.type=='Cube View'">
                                       <div class="input-group-text input-group-append input-group-prepend">
                                          <i class="fa view" title="{{'VIEW' | translate}}"></i>
                                       </div>

                                       <input spellcheck="false" type="text"
                                          class="input-group-append input-group-prepend form-control"
                                          ng-model="action.view" placeholder="Enter view name..."
                                          uib-typeahead="view.Name for view in lists.cubes[action.instance].views[action.cube] | filter:$viewValue | limitTo:20"
                                          typeahead-append-to-body="true" spellcheck="false" autofocus />
                                    </div>

                                    <div class="input-group mt-2" ng-if="action.type=='Dimension Editor'">
                                       <div class="input-group-text input-group-append input-group-prepend">
                                          <i class="fa dimension" title="{{'DIMENSION' | translate}}"></i>
                                       </div>
                                       <input spellcheck="false" type="text"
                                          class="input-group-append input-group-prepend form-control"
                                          ng-model="action.dimension" placeholder="Enter dimension name..."
                                          uib-typeahead="dim.Name for dim in lists.dimensionsInfo[action.instance].dimensions | filter:$viewValue | limitTo:20"
                                          typeahead-append-to-body="true" spellcheck="false" autofocus />
                                    </div>

                                    <div class="input-group mt-2"
                                       ng-if="action.type=='Dimension Editor' && values.enableNewHierarchyCreation[action.instance]">
                                       <div class="input-group-text input-group-append input-group-prepend">
                                          <i class="fa hierarchy"></i>
                                       </div>

                                       <input spellcheck="false" type="text"
                                          class="input-group-append input-group-prepend form-control"
                                          ng-model="action.hierarchy" placeholder="Enter hierarchy name..."
                                          uib-typeahead="hierarchy.Name for hierarchy in lists.dimensionsInfo[action.instance].dimensions[action.dimension].hierarchies | filter:$viewValue | limitTo:20"
                                          typeahead-append-to-body="true" spellcheck="false" autofocus />
                                    </div>
                                    <div class="input-group mt-2" ng-if="action.type=='Subset Editor'">
                                       <div class="input-group-text input-group-append input-group-prepend">
                                          <i class="fa dimension"></i>
                                       </div>
                                       <input spellcheck="false" type="text"
                                          class="input-group-append input-group-prepend form-control"
                                          ng-model="action.dimension" placeholder="Enter dimension name..."
                                          uib-typeahead="dim.Name for dim in lists.dimensionsInfo[action.instance].dimensions | filter:$viewValue | limitTo:20"
                                          typeahead-append-to-body="true" spellcheck="false" autofocus />
                                    </div>
                                    <div class="input-group mt-2"
                                       ng-if="action.type=='Subset Editor' && values.enableNewHierarchyCreation[action.instance]">
                                       <div class="input-group-text input-group-append input-group-prepend">
                                          <i class="fa hierarchy"></i>
                                       </div>

                                       <input spellcheck="false" type="text"
                                          class="input-group-append input-group-prepend form-control"
                                          ng-model="action.hierarchy" placeholder="Enter hierarchy name..."
                                          uib-typeahead="hierarchy.Name for hierarchy in lists.dimensionsInfo[action.instance].dimensions[action.dimension].hierarchies | filter:$viewValue | limitTo:20"
                                          typeahead-append-to-body="true" spellcheck="false" autofocus />
                                    </div>

                                    <div class="input-group mt-2"
                                       ng-if="action.type=='Subset Editor' && values.enableNewHierarchyCreation[action.instance]">
                                       <div class="input-group-text input-group-append input-group-prepend">
                                          <i class="fa subset"></i>
                                       </div>
                                       <input spellcheck="false" type="text"
                                          class="input-group-append input-group-prepend form-control"
                                          ng-model="action.subset" placeholder="Enter subset name..."
                                          uib-typeahead="subset.Name for subset in lists.dimensionsInfo[action.instance].dimensions[action.dimension].hierarchies[action.hierarchy].subsets | filter:$viewValue | limitTo:20"
                                          typeahead-append-to-body="true" spellcheck="false" autofocus />
                                    </div>

                                    <div class="input-group mt-2"
                                       ng-if="action.type=='Subset Editor' && !values.enableNewHierarchyCreation[action.instance]">
                                       <div class="input-group-text input-group-append input-group-prepend">
                                          <i class="fa subset"></i>
                                       </div>

                                       <input spellcheck="false" type="text"
                                          class="input-group-append input-group-prepend form-control"
                                          placeholder="Enter subset name..." ng-model="action.subset"
                                          uib-typeahead="subset.Name for subset in lists.dimensionsInfo[action.instance].dimensions[action.dimension].hierarchies[action.dimension].subsets | filter:$viewValue | limitTo:20"
                                          typeahead-append-to-body="true" spellcheck="false" autofocus />
                                    </div>

                                    <div class="input-group mt-2" ng-if="action.type=='Process'">
                                       <div class="input-group-append input-group-prepend">

                                          <span class="input-group-text input-group-append input-group-prepend"><i
                                                class="fa process"></i></span>
                                       </div>

                                       <input spellcheck="false" type="text"
                                          class="input-group-append input-group-prepend form-control"
                                          placeholder="Enter process name..." ng-model="action.process"
                                          uib-typeahead="pro.Name for pro in lists.processes[action.instance] | filter:$viewValue | limitTo:20"
                                          typeahead-append-to-body="true" spellcheck="false" autofocus />
                                    </div>

                                    <div class="input-group mt-2" ng-if="action.type=='Link'">
                                       <div class="input-group-text input-group-append input-group-prepend">
                                          <i class="fa fa-font"></i>
                                       </div>
                                       <input spellcheck="false" type="text" class="form-control"
                                          placeholder="Enter Text..." ng-model="action.text" />
                                    </div>

                                    <div class="input-group mt-2" ng-if="action.type=='Link'">
                                       <div class="input-group-text input-group-append input-group-prepend">
                                          <i class="fa fa-globe"></i>
                                       </div>
                                       <input spellcheck="false" type="text" class="form-control"
                                          placeholder="Enter Address..." ng-model="action.link" />
                                    </div>
                                    <div class="input-group mt-2" ng-if="action.type=='Chore'">
                                       <div class="input-group-append input-group-prepend">
                                          <span class="input-group-text input-group-append input-group-prepend"><i
                                                class="fa chores"></i></span>
                                       </div>

                                       <input spellcheck="false" type="text"
                                          class="input-group-append input-group-prepend form-control"
                                          placeholder="Enter chore name..." ng-model="action.chore"
                                          uib-typeahead="cho.Name for cho in lists.chores[action.instance] | filter:$viewValue | limitTo:20"
                                          typeahead-append-to-body="true" spellcheck="false" autofocus />
                                    </div>
                                    <div class="input-group mt-2">
                                       <div class="input-group-text input-group-append input-group-prepend">
                                          <i class="fa fa-info-circle"></i>
                                       </div>
                                       <input spellcheck="false" type="text" class="form-control"
                                          placeholder="Enter Description..." ng-model="action.info" />
                                    </div>
                                    <div class="input-group mt-2">
                                       <div class="input-group-text input-group-append input-group-prepend">
                                          <i class="fa fa-calendar-o" ng-class="{'fa-calendar-check-o':action.setDueDate}"></i>
                                       </div>
                                       <span class="btn btn-secondary pull-right" 
                                       ng-click="action.setDueDate=!action.setDueDate">
                                          <span translate="DUEDATE"></span>
                                          <a href class="ml-1 mr-1 pt-2">
                                             <i class="fa fa-toggle-on" ng-if="action.setDueDate"
                                                ></i>
                                             <i class="fa fa-toggle-off" ng-if="!action.setDueDate"
                                                ></i>
                                          </a>
                                       </span>
                                    </div>
                                    <div class="input-group mt-2" ng-if="action.setDueDate" uib-dropdown is-open="action.startTimeIsOpen">
                                          <span class="input-group-append">
                                             <button id="dropdownEndTime" type="button" class="btn btn-secondary"
                                                uib-dropdown-toggle>
                                                <span class="fa fa-calendar"></span>
                                             </button>
                                             <span class="dropdown-menu" uib-dropdown-menu>
                                                <datetimepicker ng-model="action.dueDate" ng-change="updateDueDate(action)"
                                                   datetimepicker-config="{modelType:'moment', startView:'day', minView:'day'}"
                                                   on-set-time="action.startTimeIsOpen=!action.startTimeIsOpen" />
                                             </span>
                                          </span>
                                          <span type="text" class="input-group-append form-control" autocomplete="off">
                                             {{action.dueDate | amDateFormat:'DD-MM-YYYY'}}
                                          </span>
                                    </div>
                                    <div class="btn-group mt-2" ng-if="action.setDueDate" >
                                       <div class="input-group-text btn-group-append btn-group-prepend">
                                          <i class="fa fa-repeat"></i>
                                       </div>
                                       <div uib-dropdown dropdown-append-to-body ng-if="action.pattern.key=='FIRSTWORKINGDAYS'">
                                          <button class="btn btn-secondary btn-group-append btn-group-prepend" uib-dropdown-toggle>
                                             {{action.firstWorkingDay.key}}<sup>{{action.firstWorkingDay.sup}}</sup>
                                             <span class="caret"></span>
                                          </button>
                                          <ul class="dropdown-menu" style="max-height: 400px;" uib-dropdown-menu role="menu"
                                             aria-labelledby="split-button">
                                             <li role="menuitem" ng-repeat="day in options.firstDays">
                                                <div ng-click="action.firstWorkingDay = day;updateNextDueDate(action)" class="ml-2 mr-2 click">
                                                   {{day.key}}
                                                   <sup>{{day.sup}}</sup>
                                                </div>
                                             </li>
                                          </ul>
                                       </div>
                                       <div uib-dropdown dropdown-append-to-body>
                                          <button class="btn btn-secondary btn-group-append btn-group-prepend" uib-dropdown-toggle>
                                             {{action.pattern.name}}
                                             <span class="caret"></span>
                                          </button>
                                          <ul class="dropdown-menu" style="max-height: 400px;" uib-dropdown-menu role="menu"
                                             aria-labelledby="split-button">
                                             <li role="menuitem" ng-repeat="pattern in options.recurringPaternPeriods">
                                                <div ng-click="updateActionPattern(action, pattern)" class="ml-2 mr-2 click">
                                                   <span>{{pattern.name}}</span>
                                                </div>
                                             </li>
                                          </ul>
                                       </div>
                                    </div>
                                    <div class="mt-2" ng-if="action.setDueDate && action.pattern.key!='DOESNOTREPEAT'">
                                       <span translate="NEXTDUEDATE"></span>: 
                                       <span class="badge">
                                          <i class="fa fa-fw fa-repeat"></i>                                       
                                          {{action.nextDueDate | amDateFormat:'dddd DD MMM YYYY'}}</span>
                                    </div>
                                 </div>
                              </div>
                           </div> 
                        </div>                                                  
                        <div class="card mb-2 mt-2" style="border:none">
                           <div class="card-body p-2">
                              <a href="" ng-click="addAction($index)">
                                 <i class="fa fa-fw fa-plus mr-1"></i>
                                 <span translate="ADDANACTION"></span>
                              </a>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="col-md-4 mt-2" ng-if="$root.uiPrefs.arcBauSettings.length>0">
                  <div class="card" ng-class="{'todo-opacity':$root.uiPrefs.arcBauSettings[$root.uiPrefs.arcBauValues.taskIndex].showBackgroundImage}">
                     <div class="card-body p-2">
                        <a href="" ng-click="addStep()">
                           <i class="fa fa-fw fa-plus mr-1"></i>
                           <span translate="ADDASTEP"></span>
                        </a>
                     </div>
                  </div>
               </div>
            </div>

         </auto-height>
      </div>
   </div>
</div>